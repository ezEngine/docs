{
  "conceptual": "\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"3\">In the majoriy of cases, resources are binary representations of <a href=\"~/pages/docs/assets/assets-overview.md\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"3\">assets</a> that are stored on disk. Resources can also be dynamically created at runtime based on a <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"3\">resource descriptor</em>. All resources derive from the <a href=\"https://ezengine.github.io/api-docs/d3/d0a/classez_resource.htm\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"3\">ezResource</a> base class. You cannot create or access these directly. Instead, they are managed by the <a href=\"https://ezengine.github.io/api-docs/dc/d99/classez_resource_manager.htm\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"3\">ezResourceManager</a>, which is a global singleton. In the chapters below, the following concepts will be used:</p>\n<ul sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"5\">\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"5\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"5\">Resource ID</strong>: This is a globally unique identifier, in the form of a case-sensitive string. It can be an asset GUID or a relative path into a data directory or a completely arbitrary string in case of runtime-generated resources. The resource ID must be provided when loading or creating a resource.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"6\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"6\">Resource Handle</strong>: User code should never store a pointer to a resource. Instead, a handle to a resource should be stored which is like a shared pointer (e.g. it increases the reference count of the resource). Handles come in two flavors: <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"6\">ezTypelessResourceHandle</code> and <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"6\">ezTypedResourceHandle</code>. The typeless variant allows you to store a handle to any resource of any type while the typed version only allows you to store a reference to one specific resource type. Typically there is a typed resource handle declaration for each resource type, see for example <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"6\">ezParticleEffectResourceHandle</code> for particle resources. Note that storing a resource handle marks it as <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"6\">in use</em> which prevents unloading of the resource. It is important to keep handles to resourcees around, that will be used soon, but if a handle isn't cleaned up properly, it will keep data loaded unnecessarily. So be careful where you store resource handles.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"7\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"7\">Resource Descriptor</strong>: When creating a resource, you can't just call the constructor. Instead, you need to fill out a <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"7\">resource descriptor</em> that defines the resource and tells the <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"7\">resource manager</em> to create the resource for you via e.g. <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"7\">ezResourceManager::CreateResource</code>.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"8\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"8\">Resource Pointer</strong>: At some point you will want to access the content of a resource. As resource management is heavily multi-threaded, these accesses must happen by acquiring a lock to the resource. This is usually done via the <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"8\">ezResourceLock</code>, which is explained later. The pointer must only be accessed under the lock and not stored after the lock is released.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"9\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"9\">Resource State</strong>: A resource is always in one of the following states:\n<ul sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"10\">\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"10\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"10\">Invalid</strong>: The resource no longer exists.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"11\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"11\">Unloaded</strong>: The resource is not loaded yet. Each resource that gets loaded by the resource manager starts in this state.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"12\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"12\">LoadedResourceMissing</strong>: The resource failed to load. Most likely it is missing on disk.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"13\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"13\">Loaded</strong>: The resource is loaded at some level of quality and can be used.</li>\n</ul>\n</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"14\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"14\">Fallback Resource</strong>: If a resource isn't loaded yet, a fallback resource can be returned by the <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"14\">resource manager</em>. For this to work, either the resource type or the individual resource must provide a fallback resource and the user must acquire the resource with <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"14\">ezResourceAcquireMode::AllowLoadingFallback</code>.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"15\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"15\">Quality Levels</strong>: Some resources can exist at multiple quality levels. E.g. textures can have some of their mip levels missing. The resource is considered loaded as long as any quality level is loaded.</li>\n</ul>\n<h2 id=\"loading-resources\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"17\">Loading Resources</h2>\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"19\">To load a resource, you will usually provide the <a href=\"~/pages/docs/assets/assets-overview.md#asset-guid\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"19\">asset guid</a> or a relative path to a file. Note that this does not load the resource immediately. The resource manager is lazy and only loads resources once they get <a href=\"#acquiring-resources\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"19\">acquired</a>. Similiarly, the resource manager unloads resources again, when no handles reference them anymore, and they haven't been acquiring in a while.</p>\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"20\">ezShaderResourceHandle hShader = ezResourceManager::LoadResource&lt;ezShaderResource&gt;(&quot;ResourceID&quot;);\n</code></pre>\n<h2 id=\"creating-runtime-resources\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"24\">Creating Runtime Resources</h2>\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"26\">To create a resource at runtime, you need to fill out the resource type specific resource descriptor. Below is an example of an <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"26\">ezMeshBufferResource</code> created from an <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"26\">ezGeometry</code> instance:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: resource-management-create -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"29\">ezGeometry geom;\ngeom.AddBox(ezVec3(2.0f), false);\n\nezMeshBufferResourceDescriptor desc;\ndesc.AddStream(ezGALVertexAttributeSemantic::Position, ezGALResourceFormat::XYZFloat);\ndesc.AllocateStreamsFromGeometry(geom, ezGALPrimitiveTopology::Triangles);\n\ns_hSolidBoxMeshBuffer = ezResourceManager::CreateResource&lt;ezMeshBufferResource&gt;(&quot;DebugSolidBox&quot;, std::move(desc), &quot;Mesh for Rendering Debug Solid Boxes&quot;);\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"41\">Use <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"41\">GetOrCreateResource</code> instead if you expect your resource to be created by multiple threads at the same time. E.g. your code runs inside a task or other multi-threaded environment. Unlike resources that are loaded via <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"41\">ezResourceManager::LoadResource</code>, creating resources will block until the resource is fully created (i.e. in <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"41\">Loaded</em> state) before returning to the caller. Therefore, complex resources should ideally be created inside tasks and not inside the runtime loop.</p>\n<h2 id=\"acquiring-resources\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"43\">Acquiring Resources</h2>\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"45\">To access a resource, it needs to be acquired first. This is done by creating a scoped <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"45\">ezResourceLock</code> on the handle. There are multiple modes for how a resource can be acquired, as defined by <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"45\">ezResourceAcquireMode</code>:</p>\n<ul sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"46\">\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"46\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"46\">PointerOnly</strong>: This will only acquire the pointer to the resource. It will not trigger the resource manager to actually load this resource from disk. Use this if you merely want to e.g. register to <a href=\"#listening-for-resource-changes\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"46\">resource changes</a>.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"47\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"47\">BlockTillLoaded</strong>: As the name suggests, this blocks the current thread until the resource has switched to the <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"47\">Loaded</em> state. This does NOT mean that all quality levels are loaded.</li>\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"48\"><strong sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"48\">AllowLoadingFallback</strong>: If the resource is loaded, it is immediately returned. If not, a fallback resouce is returned instead. If no fallback exists, this will assert. Prefer this version as is does not block.</li>\n</ul>\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"50\">For additional modes and further information, please refer to the <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"50\">ezResourceAcquireMode</code> declaration.\nThe resource manager keeps track, if and when resources are attempted to be acquired, to decide which resources to load from disk. Thus, it is important that you try to acquire a resource, which you want to load, using one of the <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"51\">AllowLoadingFallback</code> variants at least once. Otherwise the resource will never switch to the <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"51\">loaded</em> state. Alternatively, you can also call <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"51\">ezResourceManager::PreloadResource()</code>.</p>\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"54\">ezShaderResourceHandle hShader = ezResourceManager::LoadResource&lt;ezShaderResource&gt;(&quot;ResourceID&quot;);\n{\n  ezResourceLock&lt;ezShaderResource&gt; pShader(hShader, ezResourceAcquireMode::AllowLoadingFallback);\n  ezResourceAcquireResult result = pShader.GetAcquireResult();\n  if (result == ezResourceAcquireResult::LoadingFallback)\n  {\n    // A fallback was returned as the resource was not loaded yet.\n    // In many cases the fallback resource can be used directly as a replacement for the actual resource.\n    // Should the final result really be required, it is best to skip the operation until a later frame.\n  }\n  else if (result == ezResourceAcquireResult::Final)\n  {\n    // The resource is loaded and can now be accesed under the lock.\n    pShader-&gt;...\n  }\n}\n</code></pre>\n<h2 id=\"listening-for-resource-changes\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"73\">Listening for Resource Changes</h2>\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"75\">You can either listen to a single resource's state changes or you can listen to the same for all resource via the resource manager. Note that if you add an event handler to a single resource's event, you need to also hold a handle to that resource as you can't unsubscribe inside the event handler callback when the resource gets destroyed.</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: resource-management-listen -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"78\">// Subscribe to resource changes of the shader\nezResourceLock&lt;ezShaderResource&gt; pShader(m_hShader, ezResourceAcquireMode::PointerOnly);\npShader-&gt;m_ResourceEvents.AddEventHandler(ezMakeDelegate(&amp;ezMaterialManager::MaterialShaderConstants::OnResourceEvent, this), m_ShaderResourceEventSubscriber);\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<!-- BEGIN-DOCS-CODE-SNIPPET: resource-management-listen-all -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"86\">// Listening to all resource events\nezResourceManager::GetResourceEvents().AddEventHandler(ezMakeDelegate(&amp;WorldData::ResourceEventHandler, this));\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<h2 id=\"unloading-of-resources\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"92\">Unloading of Resources</h2>\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"94\">There are two ways a resource can be unloaded: due to lack of handles pointing to the resource and due to forced resource unloading (tooling only).\nThe resource manager will enumerate resources with no handles on them and will start unloading them after a certain time of inactivity.</p>\n<p sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"97\">Forced resource unloading can be triggered via <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"97\">ezResourceManager::ReloadAllResources</code>, <code sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"97\">ezResourceManager::ReloadResource</code> and related functions on the resource manager. Calling these functions will immediately lock and unload the resource, switching it into the <em sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"97\">Unloaded</em> state. The next resource acquisition will trigger loading the resource again. This means that resource unload and reload can potentially happen at any time during the frame. Some resources will have custom logic to e.g. double buffer its state to make sure resource switching happens at fixed times in the frame.</p>\n<h2 id=\"see-also\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"99\">See Also</h2>\n<ul sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"101\">\n<li sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"101\"><a href=\"~/pages/docs/assets/assets-overview.md\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"101\">Asset Overview</a></li>\n</ul>\n",
  "type": "Conceptual",
  "source": {
    "remote": {
      "path": "pages/docs/runtime/resource-management.md",
      "branch": "main",
      "repo": "https://github.com/ezEngine/docs-src"
    },
    "startLine": 0,
    "endLine": 0
  },
  "path": "pages/docs/runtime/resource-management.md",
  "documentation": {
    "remote": {
      "path": "pages/docs/runtime/resource-management.md",
      "branch": "main",
      "repo": "https://github.com/ezEngine/docs-src"
    },
    "startLine": 0,
    "endLine": 0
  },
  "_appFaviconPath": "assets/images/favicon.svg",
  "_appFooter": "Hello",
  "_appLogoPath": "assets/images/EZ-text.svg",
  "_appName": "ezEngine",
  "_appTitle": "ezEngine",
  "_enableGoogleAnalytics": true,
  "_enableNewTab": true,
  "_enableSearch": true,
  "_gitContribute": {
    "repo": "https://github.com/ezEngine/docs-src",
    "branch": "main"
  },
  "_systemKeys": [
    "conceptual",
    "type",
    "source",
    "path",
    "documentation",
    "title",
    "rawTitle",
    "wordCount"
  ],
  "rawTitle": "<h1 id=\"resource-management\" sourcefile=\"pages/docs/runtime/resource-management.md\" sourcestartlinenumber=\"1\">Resource Management</h1>",
  "title": "Resource Management",
  "wordCount": 1218,
  "_key": "pages/docs/runtime/resource-management.md",
  "_navKey": "~/toc.yml",
  "_navPath": "toc.html",
  "_navRel": "../../../toc.html",
  "_path": "pages/docs/runtime/resource-management.html",
  "_rel": "../../../",
  "_tocKey": "~/pages/docs/toc.md",
  "_tocPath": "pages/docs/toc.html",
  "_tocRel": "../toc.html",
  "__global": {
    "namespacesInSubtitle": "Namespaces",
    "classesInSubtitle": "Classes",
    "structsInSubtitle": "Structs",
    "interfacesInSubtitle": "Interfaces",
    "enumsInSubtitle": "Enums",
    "delegatesInSubtitle": "Delegates",
    "constructorsInSubtitle": "Constructors",
    "fieldsInSubtitle": "Fields",
    "propertiesInSubtitle": "Properties",
    "methodsInSubtitle": "Methods",
    "eventsInSubtitle": "Events",
    "operatorsInSubtitle": "Operators",
    "eiisInSubtitle": "Explicit Interface Implementations",
    "functionsInSubtitle": "Functions",
    "variablesInSubtitle": "Variables",
    "typeAliasesInSubtitle": "Type Aliases",
    "membersInSubtitle": "Members",
    "improveThisDoc": "Edit this page",
    "viewSource": "View Source",
    "inheritance": "Inheritance",
    "derived": "Derived",
    "inheritedMembers": "Inherited Members",
    "package": "Package",
    "namespace": "Namespace",
    "assembly": "Assembly",
    "syntax": "Syntax",
    "overrides": "Overrides",
    "implements": "Implements",
    "remarks": "Remarks",
    "examples": "Examples",
    "seealso": "See Also",
    "declaration": "Declaration",
    "parameters": "Parameters",
    "typeParameters": "Type Parameters",
    "type": "Type",
    "name": "Name",
    "description": "Description",
    "returns": "Returns",
    "fieldValue": "Field Value",
    "propertyValue": "Property Value",
    "eventType": "Event Type",
    "variableValue": "Variable Value",
    "typeAliasType": "Type Alias Type",
    "exceptions": "Exceptions",
    "condition": "Condition",
    "extensionMethods": "Extension Methods",
    "note": "Note",
    "warning": "Warning",
    "tip": "Tip",
    "important": "Important",
    "caution": "Caution",
    "tocToggleButton": "Show / Hide Table of Contents",
    "tocFilter": "Filter by title",
    "search": "Search",
    "searchResults": "Search Results for",
    "searchResultsCount": "{count} results for \"{query}\"",
    "searchNoResults": "No results for \"{query}\"",
    "pageFirst": "First",
    "pagePrev": "Previous",
    "pageNext": "Next",
    "pageLast": "Last",
    "inThisArticle": "In this article",
    "nextArticle": "Next",
    "prevArticle": "Previous",
    "backToTop": "Back to top",
    "themeLight": "Light",
    "themeDark": "Dark",
    "themeAuto": "Auto",
    "changeTheme": "Change theme",
    "copy": "Copy",
    "downloadPdf": "Download PDF",
    "_shared": {}
  },
  "_disableToc": false,
  "docurl": "https://github.com/ezEngine/docs-src/blob/main/pages/docs/runtime/resource-management.md/#L1"
}