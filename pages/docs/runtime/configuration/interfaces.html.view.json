{
  "conceptual": "\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"3\"><em sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"3\">Singletons</em> are classes of which there should only be a single instance throughout the lifetime of the process. Although EZ uses the <em sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"3\">singleton pattern</em> quite extensively for built-in classes, such as <code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"3\">ezTaskSystem</code> and <code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"3\">ezResourceManager</code>, those classes don't use dedicated singleton infrastructure. Instead, they only expose static functions, and there is no need for any instance.</p>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"5\">Accessing such singletons is trivial, as you can always call their functions directly. However, there is another type of singleton, which does require special handling.</p>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"7\">There are cases where you want to define an <em sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"7\">interface</em> to make certain functionality available, but you may have different implementations. Only one implementation should ever be active, though. Concrete examples are the integrations of third party libraries. For example there is an <code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"7\">ezFrameCaptureInterface</code>. This class defines an interface through which <code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"7\">ezGameApplicationBase</code> can do a capture of the rendered frame, which can be used for debugging graphics issues. However, <em sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"7\">how</em> such a frame capture could be taken, depends on the platform, the installed tools, the used graphics API and so on. This functionality may be available or not and the exact implementation that is needed can differ drastically.</p>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"9\">Therefore, we want to be able to dynamically load the necessary implementation and make it available through the abstract interface. For the <code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"9\">ezFrameCaptureInterface</code> we have an implementation by our <a href=\"~/pages/docs/debugging/renderdoc.md\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"9\">RenderDoc integration</a>. In the future we might have a second implementation for PIX or some other platform specific tool.</p>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"11\">Using the singleton infrastructure, we can simply load an <a href=\"~/pages/docs/custom-code/cpp/engine-plugins.md\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"11\">engine plugin</a> that contains an implementation, and from that plugin register our implementation for that interface. Other code can then query for an instance of this interface and, if available, use it without knowing anything about the implementation, and without the need to link against that library.</p>\n<h2 id=\"implementing-singletons\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"13\">Implementing Singletons</h2>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"15\">This section shows all the pieces needed for a singleton. You can find the sample code in the <a href=\"~/pages/samples/sample-game-plugin.md\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"15\">Sample Game Plugin</a>.</p>\n<h3 id=\"interface-base-class\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"17\">Interface Base Class</h3>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"19\">First, you need to have a virtual base class that declares the actual interface.</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: singleton-interface -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"22\">/// \\brief Pure virtual interface for demonstrating the singleton work flow\n///\n/// This declaration would typically be in a shared location, that all code can #include\nclass PrintInterface\n{\npublic:\n  virtual ~PrintInterface() = default;\n\n  virtual void Print(const ezFormatString&amp; text) = 0;\n};\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"36\">This is the class through which other code will later access the functionality, so it must be in a shared location.</p>\n<h3 id=\"interface-implementation\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"38\">Interface Implementation</h3>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"40\">Next, you need one or more <em sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"40\">implementations</em> of your interface. You can, of course, have zero implementations, if all you want to provide is the option for future extensibility, and your code should generally be able to handle the fact that no implementation is currently loaded.</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: singleton-impl-declaration -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"43\">/// \\brief Implementation of the PrintInterface, just forwards the text to ezLog::Info()\n///\n/// This would typically be in a different plugin than the interface and would be allocated by that plugin on startup.\nclass PrintImplementation : public PrintInterface\n{\n  EZ_DECLARE_SINGLETON_OF_INTERFACE(PrintImplementation, PrintInterface);\n\npublic:\n  PrintImplementation();\n\n  virtual void Print(const ezFormatString&amp; text) override;\n\nprivate:\n  // needed for the startup system to be able to call the private function below\n  EZ_MAKE_SUBSYSTEM_STARTUP_FRIEND(SampleGamePluginStartupGroup, SampleGamePluginMainStartup);\n\n  void OnCoreSystemsStartup()\n  {\n    /* we could do something important here */\n  }\n};\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"68\">Note the <code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"68\">EZ_DECLARE_SINGLETON_OF_INTERFACE</code> macro. This adds one part of the required functionality. For one, this class adds a function to query the one and only instance of your class (<code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"68\">GetSingleton()</code>). Also, it prevents you from creating two instances of this class, as that would violate the singleton contract.</p>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"70\">Finally, you need to add this to you cpp file:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: singleton-impl-definition -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"73\">EZ_IMPLEMENT_SINGLETON(PrintImplementation);\n\nPrintImplementation::PrintImplementation()\n  : m_SingletonRegistrar(this) // needed for automatic registration\n{\n}\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"83\">The macro again inserts vital code for your singleton to work. The constructor also has to follow the pattern shown above.</p>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"85\">You can now implement the desired behavior for the overridden functions.</p>\n<h2 id=\"instantiating-singletons\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"87\">Instantiating Singletons</h2>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"89\">The EZ singleton infrastructure does not automatically create an instance of singleton classes. It is up to you whether, when and how you create your instance. The most common way to do this, is to leverage the <a href=\"~/pages/docs/runtime/configuration/startup.md\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"89\">startup system</a> to hook into the engine startup process at the right time.</p>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"91\">For details, read that chapter, but here is what you would typically do. At startup you instantiate your singleton implementation:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: singleton-allocate -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"94\">ON_CORESYSTEMS_STARTUP\n{\n  // allocate an implementation of PrintInterface\n  s_PrintInterface = EZ_DEFAULT_NEW(PrintImplementation);\n\n  s_PrintInterface-&gt;OnCoreSystemsStartup();\n  s_PrintInterface-&gt;Print(&quot;Called ON_CORESYSTEMS_STARTUP&quot;);\n}\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"106\">And at shutdown you make sure to clean it up again:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: singleton-deallocate -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"109\">ON_CORESYSTEMS_SHUTDOWN\n{\n  s_PrintInterface-&gt;Print(&quot;Called ON_CORESYSTEMS_SHUTDOWN&quot;);\n\n  // clean up the s_PrintInterface, otherwise we would get asserts about memory leaks at shutdown\n  s_PrintInterface.Clear();\n}\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<h2 id=\"accessing-singletons\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"120\">Accessing Singletons</h2>\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"122\">There are two ways that you can access your singleton instance. In a piece of code that knows for certain that it will only run in conjunction with a specific singleton implementation, you can access it directly:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: singleton-query-instance -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"125\">PrintImplementation::GetSingleton()-&gt;Print(&quot;Called ON_HIGHLEVELSYSTEMS_SHUTDOWN&quot;);\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"130\">This is the most efficient way. However, use cases for this should be relatively rare. The more common situation is, when you want to get the implementation for an interface. To do so, you need to go through <code sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"130\">ezSingletonRegistry</code>:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: singleton-query-interface -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"133\">ezSingletonRegistry::GetSingletonInstance&lt;PrintInterface&gt;()-&gt;Print(&quot;Called ON_HIGHLEVELSYSTEMS_STARTUP&quot;);\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"138\">Here we don't need to know anything about the implementation and therefore have no link dependency on the library that provides it. This is how most code would access a singleton implementation. Be aware that this requires a more expensive lookup, so locally cache the result, if you want to do multiple function calls on it.</p>\n<h2 id=\"see-also\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"140\">See Also</h2>\n<ul sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"142\">\n<li sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"142\"><a href=\"~/pages/docs/runtime/configuration/startup.md\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"142\">Startup System</a></li>\n<li sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"143\"><a href=\"~/pages/docs/custom-code/cpp/engine-plugins.md\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"143\">Engine Plugins</a></li>\n</ul>\n",
  "type": "Conceptual",
  "source": {
    "remote": {
      "path": "pages/docs/runtime/configuration/interfaces.md",
      "branch": "docfx_update",
      "repo": "https://github.com/ezEngine/docs-src"
    },
    "startLine": 0.0,
    "endLine": 0.0
  },
  "path": "pages/docs/runtime/configuration/interfaces.md",
  "documentation": {
    "remote": {
      "path": "pages/docs/runtime/configuration/interfaces.md",
      "branch": "docfx_update",
      "repo": "https://github.com/ezEngine/docs-src"
    },
    "startLine": 0.0,
    "endLine": 0.0
  },
  "_appFaviconPath": "assets/images/favicon.svg",
  "_appFooter": "Hello",
  "_appLogoPath": "assets/images/EZ-text.svg",
  "_appName": "ezEngine",
  "_appTitle": "ezEngine",
  "_enableGoogleAnalytics": true,
  "_enableNewTab": true,
  "_enableSearch": true,
  "_gitContribute": {
    "repo": "https://github.com/ezEngine/docs-src",
    "branch": "main"
  },
  "_systemKeys": [
    "conceptual",
    "type",
    "source",
    "path",
    "documentation",
    "title",
    "rawTitle",
    "wordCount"
  ],
  "rawTitle": "<h1 id=\"singleton-interfaces\" sourcefile=\"pages/docs/runtime/configuration/interfaces.md\" sourcestartlinenumber=\"1\">Singleton Interfaces</h1>",
  "title": "Singleton Interfaces",
  "wordCount": 887.0,
  "_key": "pages/docs/runtime/configuration/interfaces.md",
  "_navKey": "~/toc.yml",
  "_navPath": "toc.html",
  "_navRel": "../../../../toc.html",
  "_path": "pages/docs/runtime/configuration/interfaces.html",
  "_rel": "../../../../",
  "_tocKey": "~/pages/docs/toc.md",
  "_tocPath": "pages/docs/toc.html",
  "_tocRel": "../../toc.html",
  "__global": {
    "namespacesInSubtitle": "Namespaces",
    "classesInSubtitle": "Classes",
    "structsInSubtitle": "Structs",
    "interfacesInSubtitle": "Interfaces",
    "enumsInSubtitle": "Enums",
    "delegatesInSubtitle": "Delegates",
    "constructorsInSubtitle": "Constructors",
    "fieldsInSubtitle": "Fields",
    "propertiesInSubtitle": "Properties",
    "methodsInSubtitle": "Methods",
    "eventsInSubtitle": "Events",
    "operatorsInSubtitle": "Operators",
    "eiisInSubtitle": "Explicit Interface Implementations",
    "functionsInSubtitle": "Functions",
    "variablesInSubtitle": "Variables",
    "typeAliasesInSubtitle": "Type Aliases",
    "membersInSubtitle": "Members",
    "improveThisDoc": "Edit this page",
    "viewSource": "View Source",
    "inheritance": "Inheritance",
    "derived": "Derived",
    "inheritedMembers": "Inherited Members",
    "package": "Package",
    "namespace": "Namespace",
    "assembly": "Assembly",
    "syntax": "Syntax",
    "overrides": "Overrides",
    "implements": "Implements",
    "remarks": "Remarks",
    "examples": "Examples",
    "seealso": "See Also",
    "declaration": "Declaration",
    "parameters": "Parameters",
    "typeParameters": "Type Parameters",
    "type": "Type",
    "name": "Name",
    "description": "Description",
    "returns": "Returns",
    "fieldValue": "Field Value",
    "propertyValue": "Property Value",
    "eventType": "Event Type",
    "variableValue": "Variable Value",
    "typeAliasType": "Type Alias Type",
    "exceptions": "Exceptions",
    "condition": "Condition",
    "extensionMethods": "Extension Methods",
    "note": "Note",
    "warning": "Warning",
    "tip": "Tip",
    "important": "Important",
    "caution": "Caution",
    "tocToggleButton": "Show / Hide Table of Contents",
    "tocFilter": "Filter by title",
    "search": "Search",
    "searchResults": "Search Results for",
    "searchResultsCount": "{count} results for \"{query}\"",
    "searchNoResults": "No results for \"{query}\"",
    "pageFirst": "First",
    "pagePrev": "Previous",
    "pageNext": "Next",
    "pageLast": "Last",
    "inThisArticle": "In this article",
    "nextArticle": "Next",
    "prevArticle": "Previous",
    "backToTop": "Back to top",
    "themeLight": "Light",
    "themeDark": "Dark",
    "themeAuto": "Auto",
    "changeTheme": "Change theme",
    "copy": "Copy",
    "downloadPdf": "Download PDF",
    "_shared": {}
  },
  "_disableToc": false,
  "docurl": "https://github.com/ezEngine/docs-src/blob/main/pages/docs/runtime/configuration/interfaces.md/#L1"
}