{
  "conceptual": "\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"3\">To write a custom C++ component, the first thing you need is a custom <a href=\"~/pages/docs/custom-code/cpp/engine-plugins.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"3\">engine plugin</a>. Once you have that, and have it enabled in your <a href=\"~/pages/docs/projects/project-settings.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"3\">project settings</a>, any custom component that you define in that plugin will show up in the editor and can be attached to <a href=\"~/pages/docs/runtime/world/game-objects.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"3\">game objects</a>.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"5\">The <a href=\"~/pages/samples/sample-game-plugin.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"5\">Sample Game Plugin</a> shows all the pieces that you need, including multiple components to get inspiration from. This article describes the steps to create a simple custom component.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"7\">Before you continue, please read the <a href=\"~/pages/docs/runtime/world/components.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"7\">components chapter</a>, as it already covers most things that you need to know.</p>\n<h2 id=\"component-manager-declaration\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"9\">Component Manager Declaration</h2>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"11\">For every type of C++ component there is a corresponding <a href=\"~/pages/docs/runtime/world/component-managers.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"11\">component manager</a>. The component manager is responsible for allocating and deallocating components and for updating them. Each component manager is tied to a single <a href=\"~/pages/docs/runtime/world/worlds.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"11\">world</a>, so if you have multiple worlds, each world will hold its own instance of each component manager.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"13\">A component manager is a <a href=\"~/pages/docs/runtime/world/world-modules.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"13\">world module</a>, so it can register functions to be called during specific <a href=\"~/pages/docs/runtime/world/world-modules.md#update-phases\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"13\">update phases</a> of the world.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"15\">For the vast majority of components we only need a component manager that calls <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"15\">Update()</code> on our component type once a frame. We can declare such a simple manager like this in the header file for our component:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: customcomp-manager -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"18\">using DemoComponentManager = ezComponentManagerSimple&lt;class DemoComponent, ezComponentUpdateType::WhenSimulating&gt;;\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<h2 id=\"component-class-declaration\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"23\">Component Class Declaration</h2>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"25\">Next, we declare our component class. All components must derive (at least indirectly) from <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"25\">ezComponent</code>. Also vital is to insert the <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"25\">EZ_DECLARE_COMPONENT_TYPE</code> macro, where you pass in the own component class name, the base class, and the component manager class.</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: customcomp-class -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"28\">class DemoComponent : public ezComponent\n{\n  EZ_DECLARE_COMPONENT_TYPE(DemoComponent, ezComponent, DemoComponentManager);\n\n  //////////////////////////////////////////////////////////////////////////\n  // ezComponent\n\npublic:\n  virtual void SerializeComponent(ezWorldWriter&amp; stream) const override;\n  virtual void DeserializeComponent(ezWorldReader&amp; stream) override;\n\nprotected:\n  virtual void OnSimulationStarted() override;\n\n  //////////////////////////////////////////////////////////////////////////\n  // DemoComponent\n\npublic:\n  DemoComponent();\n  ~DemoComponent();\n\nprivate:\n  void Update();\n\n  float m_fAmplitude = 1.0f;             // [ property ]\n  ezAngle m_Speed = ezAngle::Degree(90); // [ property ]\n};\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"59\">Here we override a couple of functions from <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"59\">ezComponent</code>. For the binary serialization we must implement <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"59\">ezComponent::SerializeComponent()</code>. As long as you test your component only inside the editor, you don't yet need to implement these functions, as the editor stores reflected properties automatically. However, once you want to export your scene, these functions are used, and if you forgot to properly serialize something, the exported scene will not work correctly.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"61\">Note that our sample component has a (non-virtual) function called <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"61\">Update()</code>. This is necessary because we use the <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"61\">ezComponentManagerSimple</code> here, which expects to find such a function. If you write your own component manager, you can do this differently.</p>\n<h2 id=\"reflection-block\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"63\">Reflection Block</h2>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"65\">In our cpp file we need to insert a <a href=\"~/pages/docs/runtime/reflection-system.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"65\">reflection</a> block for our component type. This tells the engine all the details about our component, for instance which properties it has.</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: customcomp-reflection -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"68\">// clang-format off\nEZ_BEGIN_COMPONENT_TYPE(DemoComponent, 3 /* version */, ezComponentMode::Dynamic)\n{\n  EZ_BEGIN_PROPERTIES\n  {\n    EZ_MEMBER_PROPERTY(&quot;Amplitude&quot;, m_fAmplitude)-&gt;AddAttributes(new ezDefaultValueAttribute(1), new ezClampValueAttribute(0, 10)),\n    EZ_MEMBER_PROPERTY(&quot;Speed&quot;, m_Speed)-&gt;AddAttributes(new ezDefaultValueAttribute(ezAngle::Degree(90))),\n  }\n  EZ_END_PROPERTIES;\n\n  EZ_BEGIN_ATTRIBUTES\n  {\n    new ezCategoryAttribute(&quot;SampleGamePlugin&quot;),\n  }\n  EZ_END_ATTRIBUTES;\n}\nEZ_END_COMPONENT_TYPE\n// clang-format on\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"90\">This information is used in various ways. The editor uses it for the UI. Attributes on each property allow you to configure what default values the editor should use, and whether it should clamp the range for values, etc. Bindings to other languages also use this information to generate the necessary code. Everything that is not mentioned in this block, is internal to the C++ code and hidden from the tools.</p>\n<h2 id=\"initialization-and-update\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"92\">Initialization and Update</h2>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"94\">Next up, we implement our basic component code:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: customcomp-basics -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"97\">DemoComponent::DemoComponent() = default;\nDemoComponent::~DemoComponent() = default;\n\nvoid DemoComponent::OnSimulationStarted()\n{\n  SUPER::OnSimulationStarted();\n\n  // this component doesn't need to anything for initialization\n}\n\nvoid DemoComponent::Update()\n{\n  const ezTime curTime = GetWorld()-&gt;GetClock().GetAccumulatedTime();\n  const ezAngle curAngle = curTime.AsFloatInSeconds() * m_Speed;\n  const float curHeight = ezMath::Sin(curAngle) * m_fAmplitude;\n\n  GetOwner()-&gt;SetLocalPosition(ezVec3(0, 0, curHeight));\n}\n\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"120\">Components rarely need to do much in their constructor and destructor. Most setup should be done in <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"120\">ezComponent::OnSimulationStarted()</code>. For components that should already have functionality in the editor, while the simulation is not yet running, you should do your setup in <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"120\">ezComponent::OnActivated()</code> instead. There is no <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"120\">OnSimulationStopped()</code>, as this would always be the same as <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"120\">ezComponent::OnDeactivated()</code>.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"122\">As you can see, this component modifies the position of its owner object during its update. This is why we had to use <code sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"122\">ezComponentMode::Dynamic</code> in the reflection block, to tell the engine that objects with this component attached may change their position.</p>\n<h2 id=\"serialization\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"124\">Serialization</h2>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"126\">Finally, to make our component also work in exported scenes, we need to implement serialization:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: component-serialize -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"129\">void DemoComponent::SerializeComponent(ezWorldWriter&amp; stream) const\n{\n  SUPER::SerializeComponent(stream);\n\n  auto&amp; s = stream.GetStream();\n\n  s &lt;&lt; m_fAmplitude;\n  s &lt;&lt; m_Speed;\n}\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"142\">This writes out the data in the latest format. If you change the format, you should increase the version number of your component in the reflection block at the very top.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"144\">Obviously, at runtime we also need to deserialize our component. This is where we implement backwards compatibility for older exported scenes:</p>\n<!-- BEGIN-DOCS-CODE-SNIPPET: component-deserialize -->\n<pre><code class=\"lang-cpp\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"147\">void DemoComponent::DeserializeComponent(ezWorldReader&amp; stream)\n{\n  SUPER::DeserializeComponent(stream);\n  const ezUInt32 uiVersion = stream.GetComponentTypeVersion(GetStaticRTTI());\n\n  auto&amp; s = stream.GetStream();\n\n  s &gt;&gt; m_fAmplitude;\n\n  if (uiVersion &lt;= 2)\n  {\n    // up to version 2 the angle was stored as a float in degree\n    // convert this to ezAngle\n    float fDegree;\n    s &gt;&gt; fDegree;\n    m_Speed = ezAngle::Degree(fDegree);\n  }\n  else\n  {\n    s &gt;&gt; m_Speed;\n  }\n}\n</code></pre>\n<!-- END-DOCS-CODE-SNIPPET -->\n<h2 id=\"conclusion\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"173\">Conclusion</h2>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"175\">Adding a custom component in C++ is not hard. Use the <a href=\"~/pages/samples/sample-game-plugin.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"175\">Sample Game Plugin</a> as a playground to get started. Of course with C++ you have the typical restriction that you can't hot reload code, you have to close the editor, compile your plugin and reopen the editor. <a href=\"~/pages/docs/custom-code/cpp/cpp-code-reload.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"175\">Hot Reloading C++ Game Plugins in the Editor</a> describes a mechanism that can basically do all that for you with a single button press, though.</p>\n<p sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"177\">Armed with these basics, you should have a look at existing components to see how to solve specific issues.</p>\n<h2 id=\"see-also\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"179\">See Also</h2>\n<ul sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"181\">\n<li sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"181\"><a href=\"~/pages/docs/runtime/world/components.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"181\">Components</a></li>\n<li sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"182\"><a href=\"~/pages/docs/custom-code/custom-code-overview.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"182\">Custom Code</a></li>\n<li sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"183\"><a href=\"~/pages/samples/sample-game-plugin.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"183\">Sample Game Plugin</a></li>\n<li sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"184\"><a href=\"~/pages/docs/custom-code/cpp/cpp-code-reload.md\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"184\">Hot Reloading C++ Game Plugins in the Editor</a></li>\n</ul>\n",
  "type": "Conceptual",
  "source": {
    "remote": {
      "path": "pages/docs/custom-code/cpp/custom-cpp-component.md",
      "branch": "docfx_update",
      "repo": "https://github.com/ezEngine/docs-src"
    },
    "startLine": 0.0,
    "endLine": 0.0
  },
  "path": "pages/docs/custom-code/cpp/custom-cpp-component.md",
  "documentation": {
    "remote": {
      "path": "pages/docs/custom-code/cpp/custom-cpp-component.md",
      "branch": "docfx_update",
      "repo": "https://github.com/ezEngine/docs-src"
    },
    "startLine": 0.0,
    "endLine": 0.0
  },
  "_appFaviconPath": "assets/images/favicon.svg",
  "_appFooter": "Hello",
  "_appLogoPath": "assets/images/EZ-text.svg",
  "_appName": "ezEngine",
  "_appTitle": "ezEngine",
  "_enableGoogleAnalytics": true,
  "_enableNewTab": true,
  "_enableSearch": true,
  "_gitContribute": {
    "repo": "https://github.com/ezEngine/docs-src",
    "branch": "main"
  },
  "_systemKeys": [
    "conceptual",
    "type",
    "source",
    "path",
    "documentation",
    "title",
    "rawTitle",
    "wordCount"
  ],
  "rawTitle": "<h1 id=\"custom-components-with-c\" sourcefile=\"pages/docs/custom-code/cpp/custom-cpp-component.md\" sourcestartlinenumber=\"1\">Custom Components with C++</h1>",
  "title": "Custom Components with C++",
  "wordCount": 965.0,
  "_key": "pages/docs/custom-code/cpp/custom-cpp-component.md",
  "_navKey": "~/toc.yml",
  "_navPath": "toc.html",
  "_navRel": "../../../../toc.html",
  "_path": "pages/docs/custom-code/cpp/custom-cpp-component.html",
  "_rel": "../../../../",
  "_tocKey": "~/pages/docs/toc.md",
  "_tocPath": "pages/docs/toc.html",
  "_tocRel": "../../toc.html",
  "__global": {
    "namespacesInSubtitle": "Namespaces",
    "classesInSubtitle": "Classes",
    "structsInSubtitle": "Structs",
    "interfacesInSubtitle": "Interfaces",
    "enumsInSubtitle": "Enums",
    "delegatesInSubtitle": "Delegates",
    "constructorsInSubtitle": "Constructors",
    "fieldsInSubtitle": "Fields",
    "propertiesInSubtitle": "Properties",
    "methodsInSubtitle": "Methods",
    "eventsInSubtitle": "Events",
    "operatorsInSubtitle": "Operators",
    "eiisInSubtitle": "Explicit Interface Implementations",
    "functionsInSubtitle": "Functions",
    "variablesInSubtitle": "Variables",
    "typeAliasesInSubtitle": "Type Aliases",
    "membersInSubtitle": "Members",
    "improveThisDoc": "Edit this page",
    "viewSource": "View Source",
    "inheritance": "Inheritance",
    "derived": "Derived",
    "inheritedMembers": "Inherited Members",
    "package": "Package",
    "namespace": "Namespace",
    "assembly": "Assembly",
    "syntax": "Syntax",
    "overrides": "Overrides",
    "implements": "Implements",
    "remarks": "Remarks",
    "examples": "Examples",
    "seealso": "See Also",
    "declaration": "Declaration",
    "parameters": "Parameters",
    "typeParameters": "Type Parameters",
    "type": "Type",
    "name": "Name",
    "description": "Description",
    "returns": "Returns",
    "fieldValue": "Field Value",
    "propertyValue": "Property Value",
    "eventType": "Event Type",
    "variableValue": "Variable Value",
    "typeAliasType": "Type Alias Type",
    "exceptions": "Exceptions",
    "condition": "Condition",
    "extensionMethods": "Extension Methods",
    "note": "Note",
    "warning": "Warning",
    "tip": "Tip",
    "important": "Important",
    "caution": "Caution",
    "tocToggleButton": "Show / Hide Table of Contents",
    "tocFilter": "Filter by title",
    "search": "Search",
    "searchResults": "Search Results for",
    "searchResultsCount": "{count} results for \"{query}\"",
    "searchNoResults": "No results for \"{query}\"",
    "pageFirst": "First",
    "pagePrev": "Previous",
    "pageNext": "Next",
    "pageLast": "Last",
    "inThisArticle": "In this article",
    "nextArticle": "Next",
    "prevArticle": "Previous",
    "backToTop": "Back to top",
    "themeLight": "Light",
    "themeDark": "Dark",
    "themeAuto": "Auto",
    "changeTheme": "Change theme",
    "copy": "Copy",
    "downloadPdf": "Download PDF",
    "_shared": {}
  },
  "_disableToc": false,
  "docurl": "https://github.com/ezEngine/docs-src/blob/main/pages/docs/custom-code/cpp/custom-cpp-component.md/#L1"
}